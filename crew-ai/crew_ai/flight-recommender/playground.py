from crew_ai.config import config
from langchain_community.chat_models.fireworks import ChatFireworks
from langchain.globals import set_llm_cache, set_debug
from langchain.cache import InMemoryCache
from textwrap import dedent

from tools.scraper_tool import Scraper

set_llm_cache(InMemoryCache())
# Turn this on only if you want to debug other wise it's hard to see the conversations.
set_debug(True)

llm = ChatFireworks(
    model="accounts/fireworks/models/mistral-7b-instruct-4k",
    fireworks_api_key=config.FIREWORKS_API_KEY,
    model_kwargs={"temperature": 0.5, "max_tokens": 4096},
)

if __name__ == "__main__":
    # scraper = Scraper(llm=llm)
    # input_string = "https://www.kimkim.com/c/highlights-of-estonia-tallinn-tartu-lahemaa-national-park-haapsalu-5-days, https://www.theworldwasherefirst.com/estonia-itinerary/"

    # observation = scraper.run(input_string)

    # print(observation)
    print(
        dedent(
            """You are Travel agent.\nA resourceful travel agent with extensive information\n        about the city, it's attractions and customs.\n\nYour personal goal is: Provide the latest and  BEST insights about the destination city.TOOLS:\n------\nYou have access to the following tools:\n\nDuckDuckGo Results JSON: A wrapper around Duck Duck Go Search. Useful for when you need to answer questions about current events. Input should be a search query. Output is a JSON array of the query results\nwebsite_scrapper: \n\"Scrape websites for information. Remember for ActionInput you have to extract comma separted urls like example below.\n\n```\nhttps://visitestonia.ee, https://exploreestonia.ee\n```\n\n\nTo use a tool, please use the exact following format:\n\n```\nThought: Do I need to use a tool? Yes\nAction: the action to take, should be one of [DuckDuckGo Results JSON, website_scrapper], just the name.\nAction Input: the input to the action\nObservation: the result of the action\n```\n\nWhen you have a response for your task, or if you do not need to use a tool, you MUST use the format:\n\n```\nThought: Do I need to use a tool? No\nFinal Answer: [your response here]This is the summary of your work so far:\nBegin! This is VERY important to you, your job depends on it!\n\nCurrent Task: \nYou must compile THE latest\nin-depth guide for someone traveling and wanting \nto have THE BEST trip ever!\nYou have tools access to gather information about key attractions, local customs,\nspecial events, and daily activity recommendations.\nSearch for the best spots to go to, the kind of place only a\nlocal would know.\nBase on what you search, you should provide a thorough overview of what \nthe city has to offer, including hidden gems, cultural\nhotspots, must-visit landmarks, weather forecasts, and\nhigh level costs.\n\nThe final answer must be a comprehensive city guide, \nrich in cultural insights and practical tips, \ntailored to enhance the travel experience.\n\nTrip Date: 2024-04-01 - 2024-04-10\nTraveling from: Tallinn, Estonia\nTraveling to: Madrid, Spain\nTraveler Interests: history, food, local experience\n\n\nThis is the context you are working with:\n\nFlight offer 1\nPrice: 58.07\n\nItinerary 1:\nLayover(s): Oslo Gardermoen Airport\n\nDeparture: Tallinn Airport\nTerminal: \nDate: 2024-04-01T12:15:00\n\nArrival: Oslo Gardermoen Airport\nTerminal: \nDate: 2024-04-01T12:45:00\n\n\nDeparture: Oslo Gardermoen Airport\nTerminal: \nDate: 2024-04-01T15:30:00\n\nArrival: Madrid Barajas International Airport\nTerminal: 1\nDate: 2024-04-01T19:15:00\n\n------\nFlight offer 2\nPrice: 123.67\n\nItinerary 1:\nLayover(s): Riga International Airport\n\nDeparture: Tallinn Airport\nTerminal: \nDate: 2024-04-01T09:10:00\n\nArrival: Riga International Airport\nTerminal: \nDate: 2024-04-01T10:00:00\n\n\nDeparture: Riga International Airport\nTerminal: \nDate: 2024-04-01T13:10:00\n\nArrival: Madrid Barajas International Airport\nTerminal: 4\nDate: 2024-04-01T16:20:00\n\n------\nFlight offer 3\nPrice: 123.67\n\nItinerary 1:\nLayover(s): Riga International Airport\n\nDeparture: Tallinn Airport\nTerminal: \nDate: 2024-04-01T05:40:00\n\nArrival: Riga International Airport\nTerminal: \nDate: 2024-04-01T06:30:00\n\n\nDeparture: Riga International Airport\nTerminal: \nDate: 2024-04-01T13:10:00\n\nArrival: Madrid Barajas International Airport\nTerminal: 4\nDate: 2024-04-01T16:20:00\n\n------\nFlight offer 4\nPrice: 156.56\n\nItinerary 1:\nLayover(s): Brussels Airport\n\nDeparture: Tallinn Airport\nTerminal: \nDate: 2024-04-01T07:20:00\n\nArrival: Brussels Airport\nTerminal: \nDate: 2024-04-01T09:00:00\n\n\nDeparture: Brussels Airport\nTerminal: \nDate: 2024-04-01T14:20:00\n\nArrival: Madrid Barajas International Airport\nTerminal: 2\nDate: 2024-04-01T16:45:00\n\n------\nFlight offer 5\nPrice: 156.56\n\nItinerary 1:\nLayover(s): Brussels Airport\n\nDeparture: Tallinn Airport\nTerminal: \nDate: 2024-04-01T07:20:00\n\nArrival: Brussels Airport\nTerminal: \nDate: 2024-04-01T09:00:00\n\n\nDeparture: Brussels Airport\nTerminal: \nDate: 2024-04-01T18:00:00\n\nArrival: Madrid Barajas International Airport\nTerminal: 2\nDate: 2024-04-01T20:25:00\n\n\nThought: Do I need to use a tool? Yes\nAction: DuckDuckGo Results JSON\nAction Input: \"Madrid, Spain, travel guide, 2024-04-01 - 2024-04-10\"\nObservation: [snippet: Madrid is the biggest city in Spain by far, so strategizing your schedule can be a bit of a task. I recently spent time in the capital of Spain, and I was so glad that I built a solid Madrid itinerary before I arrived. Honestly, I would've likely missed out on the best things to do in Madrid without it., title: 6 Day Madrid Itinerary (Expert 2024 Trip Planner - Travel Lemming, link: https://travellemming.com/madrid-itinerary/], [snippet: Put your comfortable shoes in your luggage. Madrid in a day: that's our mission! Rather explore Madrid with a guide? We can help Not ready to book a tour yet? Check out our Madrid Guide for more info. Getting To Madrid If your flight arrives or departs from Madrid, use it to your advantage., title: How To See Madrid In A Day in 2024 - The Tour Guy, link: https://thetourguy.com/travel-blog/madrid-in-a-day-itinerary/], [snippet: The overall best time to visit Madrid is either during late spring or early fall, when the weather is nice and warm and there are fewer crowds causing long lines at the most famous attractions. The weather in Madrid is an important factor when it comes to planning your trip., title: The Best & Worst Times to Visit Madrid in 2024 (Our Take), link: https://travellersworldwide.com/best-time-to-visit-madrid/], [snippet: Here is a breakdown of this itinerary budget for each travel category: Accommodation: $70 per night p.p. (on average) in a nice mid-range hotel = $980 per person. Transportation: Train Barcelona-Valencia (approx. $30 ), Train Valencia-Madrid (approx $25 ), Train Madrid-Granada (approx. $50) = $105 per person., title: Best Of Spain Itinerary: 14 Days In Spain [2024] - Voices of Travel, link: https://voicesoftravel.com/spain-itinerary-14-days/]\nThought: """
        )
    )
